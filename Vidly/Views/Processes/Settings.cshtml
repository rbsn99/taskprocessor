
@{
    ViewBag.Title = "Settings";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Settings</h2>
 

<div id="process" class="container">
    <ul class="nav nav-tabs">
        <li class="active">
            <a href="#details" data-toggle="tab">Details</a>
        </li>
        <li>
            <a href="#flow" data-toggle="tab">Flow</a>
        </li>
 
    </ul>

    <div class="tab-content ">
        <div class="tab-pane active" id="details">
 
            <form class="well form-horizontal"   method="post" id="process_details_form">
                <fieldset>

                    <!-- Form Name -->
                    <legend>Process details</legend>

                    <!-- Text input-->
                    <div class="form-group">
                        <label class="col-md-4 control-label">Process ID</label>
                        <div class="col-md-4 inputGroupContainer">
                            <input id="process_id" placeholder="Process ID" class="form-control" type="text" readonly>
                        </div>
                    </div>
                    <!-- Text input-->
                    <div class="form-group">
                        <label class="col-md-4 control-label">Process GUID</label>
                        <div class="col-md-4 inputGroupContainer">
                            <input id="process_guid" placeholder="Process GUID" class="form-control" type="text" readonly>
                        </div>
                    </div>
                    <!-- Text input-->
                    <div class="form-group">
                        <label class="col-md-4 control-label">Process Name</label>
                        <div class="col-md-4 inputGroupContainer">                            
                             <input id="process_name" placeholder="Process Name" class="form-control" type="text">                      
                        </div>
                    </div>
                    
                    <!-- Text input-->
                    <div class="form-group">
                        <label class="col-md-4 control-label">Created date</label>
                        <div class="col-md-4 inputGroupContainer">
                            <input id="created_date" placeholder="Created date" class="form-control" type="text" readonly="">
                        </div>
                    </div>

                    <!-- Button -->
                    <div class="form-group">
                        <label class="col-md-4 control-label"></label>
                        <div class="col-md-4">
                            <button type="submit" class="btn" onclick="UpdateProcessDetails();">Save</button>
                        </div>
                    </div>

                </fieldset>
            </form>

        </div>
        <!--Flow tab-->
        <div class="tab-pane" id="flow">
            <h3>Process flow</h3>
            <div id="taskTypes">
                <select class="selectpicker">
                    <!--generated by JS on load-->
                </select>
                <button class="btn">Add new task</button>
                <table id="tasks" class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <th>GUID</th>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Task type</th>
                            <th>Attributes</th> 
                            <th>Recipients</th>
                            <th>Dependencies</th>                                                       
                        </tr>

                    </thead>
                    <tbody>
 
                    </tbody>
                </table>
            </div> 
        </div>
 
    </div>
</div>
 
 
 @section scripts
 {
     <script>
         $(document).ready(function () {
             var currenturl = window.location.pathname;
             var id = currenturl.substring(currenturl.lastIndexOf('/') + 1);

             LoadProcessDetails(id);
             LoadProcessTasksTypes();
             LoadProcessTasks(id);
             }
         );

         function LoadProcessTasks(id) {
             var table = $("#tasks").DataTable({
                 ajax: {
                     url: "processtasks/" + id,
                     dataSrc: ""
                 },
                 columns: [
                     {
                         data: "ProcessTaskGuid" 
                     },
                     {
                         data: "Id" 
                     },
                     {
                         data: "TaskName",
                     },
                     {
                         data: "ProcessTaskType.ProcessTaskTypeName"
                     },
                     {
                         data: "attributes" 
                     },
                     {
                         data: "recipients" 
                     },
                     {
                         data: "dependencies" 
                     }
                 ]
             });
         }

         function LoadProcessDetails(id)
         {

             $.getJSON('/api/processes/settings/' + id,
                 function (data) {
                     document.getElementById("process_id").value = data.Id;
                     document.getElementById("process_name").value = data.ProcessName;
                     document.getElementById("process_guid").value = data.ProcessGuid;
                     document.getElementById("created_date").value = data.CreatedDate;
                 });
         }

         function LoadProcessTasksTypes() {
             //alert('test');
             $.getJSON('/api/processes/tasktypes',
                     function (data) {
                         for (i = 0; i < data.length; i++) {
                             // $('#taskTypes ul').append('<li><a href="#" data-id="' + data[i].Id + '">' + data[i].ProcessTaskTypeName + '</a></li>');
                             $('#taskTypes select').append('<option>' + data[i].ProcessTaskTypeName + '</option>');
                         }
                     });
         }

         function UpdateProcessDetails() {
             $(function () {
                 var id = document.getElementById("process_id").value;
                 var process = { ProcessName: document.getElementById("process_name").value};
                 $.ajax({
                     type: "PUT",
                     data: JSON.stringify(process),
                     url: "/api/processes/settings/" + id,
                     contentType: "application/json"
                 });
             });
         }




     </script>
 }
